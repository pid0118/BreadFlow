<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org/"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layouts/breadflow_layout}"
      layout:fragment="Content">
<head>
    <meta charset="UTF-8">
    <title>제품목록</title>
    <style>
        .clickable {
            cursor: pointer;
            color: #0d6efd;
        }
        .clickable:hover {
            text-decoration: underline;
        }
        /* Remove sort arrows */
        th.datatable::after,
        th.datatable::before,
        th.table-plus::after,
        th.table-plus::before {
            display: none !important;
        }
        /* Search styling */
        .search-container {
            display: flex;
            gap: 8px;
        }
        .search-input {
            padding: 4px 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 14px;
        }
        .search-button {
            padding: 4px 16px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
        }
        .search-button:hover {
            background-color: #5a6268;
        }
    </style>
    
</head>
<body>
    <h2 class="mb-4">제품목록</h2>
    <div class="d-flex gap-3 mb-3 " style="margin-left: -0.75rem;">
        <div class="col-md-3">
            <div class="form-group">
                <select id="categorylist"
                	class="selectpicker form-control form-control-sm" data-size="5"
                    data-style="btn-outline-secondary btn-sm" multiple data-max-options="3">
                    <th:block th:each="cate : ${category}">
                    	<option onclick="categoryClick" th:value="${cate.major}" th:utext="${cate.major}"></option>
                    </th:block>
                </select>
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group">
                <select id="subList"
                	class="selectpicker form-control form-control-sm" data-size="5"
                    data-style="btn-outline-secondary btn-sm" multiple data-max-options="3">
                    
                </select>
            </div>
        </div>
    </div>
    <div class="d-flex justify-content-end gap-2 mb-3">
        <div class="search-container">
            <input type="text" name="keyword" class="search-input" placeholder="제품코드 또는 제품명 검색">
            <button class="search-button" type="submit" onclick="">검색</button>
        </div>
    </div>
    <div class="d-flex justify-content-end gap-2 mb-3">
        <button type="submit" class="btn btn-primary btn-sm" th:onclick="|location.href='@{/product/Insert}'|">등록</button>
        <button type="submit" class="btn btn-danger btn-sm">삭제</button>
    </div>
    <div class="pb-20">
        <table class="data-table table stripe hover wrap" id="productTable">
            <thead>
                <tr>
                	<th class="datatable">
	                	<div class="dt-checkbox">
	                            <input type="checkbox" name="select_all" value="1" id="example-select-all">
	                            <span class="dt-checkbox-lable"></span>
	                    </div>
                	</th>
                    <th class="table-plus">제품코드</th>
                    <th class="datatable">제품명</th>
                    <th class="datatable">소비기한</th>
                    <th class="datatable">매입가</th>
                    <th class="datatable">판매가</th>
                    <th class="datatable">규격</th>
                </tr>
            </thead>
            <tbody>
                <th:block th:each="info, sts : ${products}">
                    <tr>
                    	<td>
                    		<div class="dt-checkbox">
                                <input type="checkbox" name="id[]" value="">
                                <span class="dt-checkbox-lable"></span>
                        	</div>
                    	</td>
                        <td class="clickable" th:onclick="showProductDetail([[${info.productCode}]])">[[${info.productCode}]]</td>
                        <td class="clickable" th:onclick="showProductDetail([[${info.productCode}]])">[[${info.productName}]]</td>
                        <td>[[${info.expirationDeadline}]]</td>
                        <td>[[${info.purchasePrice}]]</td>
                        <td>[[${info.salePrice}]]</td>
                        <td>[[${info.standard}]]</td>
                    </tr>
                </th:block>
            </tbody>
        </table>
    </div>

    <!-- 제품상세보기 모달창 -->
    <div class="modal fade" id="productDetailModal" tabindex="-1" role="dialog" aria-labelledby="productDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="productDetailModalLabel">제품 상세정보</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                </div>
                <div class="modal-body">
                    <div id="productDetailContent">
                     <!-- 제품 상세 정보 -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                    <button type="submit" class="btn btn-secondary btn-sm">수정</button>
                </div>
            </div>
        </div>
    </div>

    

    <script>
    
    // 현제 모달창에서 수정하기 기능 추가하여 넣기 이미지수정하기 까지 
    
        function showProductDetail(productCode) {
            // AJAX call to fetch product details
            $.ajax({
                url: '/productListAll/' + productCode,
                method: 'GET',
                success: function(product) {
                    const content = `
                        <div>
                            <table class="table table-responsive">
                                <tr>
                                    <th>제품코드</th>
                                    <td>${product.productCode}</td>
                                    <th>카테고리</th>
                                    <td>${product.category}</td>
                                </tr>
                                <tr>
                                    <th>제품명</th>
                                    <td colspan="3">${product.productName}</td>
                                </tr>
                                <tr>
                                    <th>소비기한</th>
                                    <td>${product.expirationDeadline}</td>
                                    <th>규격</th>
                                    <td>${product.standard}</td>
                                </tr>
                                <tr>
                                    <th>매입가</th>
                                    <td>${product.purchasePrice}원</td>
                                    <th>판매가</th>
                                    <td>${product.salePrice}원</td>
                                </tr>
                            </table>
                        </div>
                    `;
                    document.getElementById('productDetailContent').innerHTML = content;
                    $('#productDetailModal').modal('show');
                },
                error: function(xhr, status, error) {
                    alert('제품 정보를 불러오는데 실패했습니다.');
                }
            });
        }

        // Modal close handlers
        $(document).ready(function() {
            // Close on X button
            $('.close').on('click', function() {
                $('#productDetailModal').modal('hide');
            });
            
            // Close on close button
            $('.btn-secondary[data-dismiss="modal"]').on('click', function() {
                $('#productDetailModal').modal('hide');
            });
            
            // Close on outside click
            $('#productDetailModal').on('click', function(e) {
                if ($(e.target).hasClass('modal')) {
                    $('#productDetailModal').modal('hide');
                }
            });

            // Initialize DataTable without sorting
            $('.data-table').DataTable({
                "ordering": false
            });
        });
        // 현제모달이 외부클릭시 닫히게끔하는 기능 -- x 버튼클릭시 닫기가능하게 바꾸기 수정버튼 클릭시 등록하면으로 전환 + 데이터넘겨서 등록화면에서 수정가능하게 만들기까지.

        
        
        
        // 카테고리 선택시 테이블에 카테고리 선택항목만 열람
        
        
        
        
        // 검색어 재품코드 or 제품명 검색시 검색항목 보기
        
		
        
        
        // 체크박스 체크후 삭제버튼 클릭시 해당품목을 삭제하시겠습니까? 작은모달창 질문후 예 버튼 클릭시 해당 품목삭제기능 
        
        		
        		
        function categoryClick() {
        	var category = $("#categoryList option;selected").val();
        	console.log(category);
        	
        	// ajax 들어가야함
        	
        }	
        		
    </script>
</body>
</html>